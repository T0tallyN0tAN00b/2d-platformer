<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Square Jumper with Double Jump</title>
<style>
  body { margin: 0; overflow: hidden; background: #87CEEB; }
  canvas { display: block; cursor: pointer; background: #87CEEB; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

const gravity = 0.6;
const platforms = [];
const platformCount = 12;
let scrollY = 0;
let score = 0;
let autoScrollSpeed = 1.2;
let gameOver = false;

// Player
const player = {
  x: 100, y: 0, width: 40, height: 40,
  dy: 0, speed: 5, jumpsLeft: 2,
  canJump: true // for jump key press control
};

// Particles
let particles = [];
function createParticles(x, y, color, count=10) {
  for(let i=0;i<count;i++){
    particles.push({
      x: x+player.width/2,
      y: y+player.height/2,
      dx: (Math.random()-0.5)*4,
      dy: (Math.random()-0.5)*4,
      size: Math.random()*4+2,
      life: 30,
      color
    });
  }
}
function updateParticles() {
  let newParticles = [];
  for(let p of particles){
    p.x += p.dx;
    p.y += p.dy;
    p.size *= 0.95;
    p.life--;
    if(p.life>0) newParticles.push(p);
  }
  particles = newParticles;
  for(let p of particles){
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x,p.y,p.size,p.size);
  }
}

// Platforms
function createPlatforms(offsetY=0){
  let lastY = offsetY + canvas.height - 50;
  for(let i=0;i<platformCount;i++){
    let width = Math.random()*100+60;
    let x = Math.random()*(canvas.width-width);
    let y = lastY-(Math.random()*60+40);
    platforms.push({x,y,width,height:10});
    lastY = y;
  }
}

// Draw
function drawPlayer(){
  ctx.fillStyle = 'orange';
  ctx.fillRect(player.x,player.y,player.width,player.height);
  ctx.strokeStyle='black';
  ctx.strokeRect(player.x,player.y,player.width,player.height);
}
function drawPlatforms(){
  ctx.fillStyle='green';
  for(let p of platforms) ctx.fillRect(p.x,p.y,p.width,p.height);
}
function drawScore(){
  ctx.fillStyle='black';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+Math.floor(score),10,30);
}
function drawGameOver(){
  ctx.fillStyle="rgba(0,0,0,0.5)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="white";
  ctx.font="40px Arial";
  ctx.fillText("Game Over!",canvas.width/2-100,canvas.height/2-40);
  ctx.font="25px Arial";
  ctx.fillText("Score: "+Math.floor(score),canvas.width/2-60,canvas.height/2);
  ctx.fillStyle="red";
  ctx.fillRect(canvas.width/2-75,canvas.height/2+40,150,50);
  ctx.fillStyle="white";
  ctx.font="22px Arial";
  ctx.fillText("Restart",canvas.width/2-40,canvas.height/2+72);
}

// Game loop
function update(){
  if(gameOver){ drawGameOver(); return; }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  player.dy += gravity;
  player.y += player.dy;

  // platform collision
  let onPlatform=false;
  for(let p of platforms){
    if(player.x + player.width > p.x &&
       player.x < p.x + p.width &&
       player.y + player.height > p.y &&
       player.y + player.height < p.y + p.height + player.dy &&
       player.dy >=0){
         player.dy=0;
         player.y=p.y - player.height;
         player.jumpsLeft=2;
         onPlatform=true;
         createParticles(player.x,player.y,"orange",10);
    }
  }

  // Auto scroll
  player.y += autoScrollSpeed;
  for(let p of platforms) p.y += autoScrollSpeed;
  scrollY += autoScrollSpeed;

  // Generate new platforms
  if(Math.min(...platforms.map(p=>p.y))>0) createPlatforms(-canvas.height);

  if(player.y>canvas.height) gameOver=true;

  score=Math.max(score,scrollY);

  drawPlatforms();
  drawPlayer();
  updateParticles();
  drawScore();
  requestAnimationFrame(update);
}

// Controls
const keys={};
document.addEventListener('keydown', e=>{
  keys[e.code]=true;
});
document.addEventListener('keyup', e=>{
  keys[e.code]=false;
  player.canJump=true;
});

function movePlayer(){
  if(!gameOver){
    if(keys['ArrowLeft']) player.x -= player.speed;
    if(keys['ArrowRight']) player.x += player.speed;
    if(keys['ArrowUp'] && player.canJump && player.jumpsLeft>0){
      player.dy=-15;
      if(player.jumpsLeft===2) createParticles(player.x,player.y,"orange",15); // first jump
      else createParticles(player.x,player.y,"white",25); // double jump
      player.jumpsLeft--;
      player.canJump=false; // prevent holding jump
    }
  }
  requestAnimationFrame(movePlayer);
}

// Restart
canvas.addEventListener("click",(e)=>{
  if(gameOver){
    const mx=e.offsetX;
    const my=e.offsetY;
    if(mx>canvas.width/2-75 && mx<canvas.width/2+75 &&
       my>canvas.height/2+40 && my<canvas.height/2+90) restartGame();
  }
});
function restartGame(){
  platforms.length=0;
  particles=[];
  scrollY=0;
  score=0;
  gameOver=false;
  player.dy=0;
  player.jumpsLeft=2;
  createPlatforms();
  let lowest = platforms.reduce((a,b)=>a.y>b.y?a:b);
  player.x = lowest.x+lowest.width/2 - player.width/2;
  player.y = lowest.y - player.height;
  update();
}

// Init
createPlatforms();
let lowest = platforms.reduce((a,b)=>a.y>b.y?a:b);
player.x = lowest.x+lowest.width/2 - player.width/2;
player.y = lowest.y - player.height;

update();
movePlayer();
</script>
</body>
</html>
