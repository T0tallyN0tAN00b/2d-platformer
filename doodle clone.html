<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smiley Jumper with Closet & Unlock Messages</title>
<style>
body { margin:0; overflow:hidden; background:#87CEEB; }
canvas { display:block; cursor:pointer; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
canvas.width=800;
canvas.height=400;

// Game constants
const gravity=0.6;
let autoScrollSpeed=3;
const platformCount=12;

// Game state
let platforms=[];
let scrollY=0;
let score=0;
let highScore=0;
let gameOver=false;
let gameStarted=false;
let inCloset=false;

// Unlock message
let unlockMessage="";
let unlockTimer=0;

// Skins
const skins = [
    {color:'orange', name:'Default', unlock:0},
    {color:'blue', name:'Blue', unlock:500},
    {color:'red', name:'Red', unlock:1000},
    {color:'purple', name:'Purple', unlock:2000}
];
let currentSkin = 0;
let unlockedSkins = [0]; // always have default unlocked

// Player
const player={x:100,y:0,width:40,height:40,dy:0,speed:7,jumpsLeft:2,canJump:true};

// Platforms
function createPlatforms(offsetY=0){
    let lastY = offsetY + canvas.height - 50;
    for(let i=0;i<platformCount;i++){
        let width=Math.random()*120+60;
        let x=Math.random()*(canvas.width-width);
        let y=lastY-(Math.random()*50+50);
        platforms.push({x,y,width,height:10});
        lastY=y;
    }
}

// Input
const keys={};
document.addEventListener('keydown',e=>keys[e.code]=true);
document.addEventListener('keyup',e=>{keys[e.code]=false; player.canJump=true;});

// Restart
function restartGame(){
    platforms=[]; scrollY=0; score=0; gameOver=false;
    player.dy=0; player.jumpsLeft=2;
    createPlatforms();
    const lowest=platforms.reduce((a,b)=>a.y>b.y?a:b);
    player.x = lowest.x+lowest.width/2-player.width/2;
    player.y = lowest.y-player.height;
}

// Draw
function drawPlayer(){
    const skinColor = skins[currentSkin].color;
    ctx.fillStyle=skinColor;
    ctx.fillRect(player.x,player.y,player.width,player.height);
    ctx.strokeStyle='black';
    ctx.strokeRect(player.x,player.y,player.width,player.height);
    // Smiley face
    ctx.fillStyle='black';
    ctx.fillRect(player.x+12,player.y+15,3,3);
    ctx.fillRect(player.x+28,player.y+15,3,3);
    ctx.beginPath();
    ctx.arc(player.x+20,player.y+25,8,0,Math.PI);
    ctx.stroke();
}

function drawPlatforms(){
    ctx.fillStyle='green';
    platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.width,p.height));
}

function drawScore(){
    ctx.fillStyle='black';
    ctx.font='20px Arial';
    ctx.fillText('Score: '+Math.floor(score),10,30);
    ctx.fillText('High Score: '+Math.floor(highScore),10,55);
}

// Draw unlock message
function drawUnlockMessage(){
    if(unlockMessage && unlockTimer>0){
        ctx.fillStyle='yellow';
        ctx.font='24px Arial';
        ctx.fillText(unlockMessage,canvas.width/2-ctx.measureText(unlockMessage).width/2,100);
        unlockTimer--;
    }
}

function drawGameOver(){
    ctx.fillStyle="rgba(0,0,0,0.5)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("Game Over!",canvas.width/2-100,canvas.height/2-40);
    ctx.font="25px Arial";
    ctx.fillText("Score: "+Math.floor(score),canvas.width/2-60,canvas.height/2);
    ctx.fillStyle="red";
    ctx.fillRect(canvas.width/2-75,canvas.height/2+40,150,50);
    ctx.fillStyle="white";
    ctx.font="22px Arial";
    ctx.fillText("Restart",canvas.width/2-40,canvas.height/2+72);
}

// Title screen
function drawTitleScreen(){
    ctx.fillStyle='black';
    ctx.font='50px Arial';
    ctx.fillText('Smiley Jumper',canvas.width/2-170,canvas.height/2-100);
    ctx.font='28px Arial';
    ctx.fillText('Click a button',canvas.width/2-80,canvas.height/2-40);

    // Draw buttons
    ctx.fillStyle='green';
    ctx.fillRect(canvas.width/2-75,canvas.height/2,150,50);
    ctx.fillRect(canvas.width/2-75,canvas.height/2+70,150,50);
    ctx.fillStyle='white';
    ctx.font='22px Arial';
    ctx.fillText('Start',canvas.width/2-25,canvas.height/2+33);
    ctx.fillText('Closet',canvas.width/2-30,canvas.height/2+103);
}

// Closet screen
function drawClosetScreen(){
    ctx.fillStyle='black';
    ctx.font='40px Arial';
    ctx.fillText('Closet',canvas.width/2-70,50);
    ctx.font='20px Arial';
    ctx.fillText('Click a skin to equip',canvas.width/2-90,80);

    // Draw skins
    skins.forEach((s,i)=>{
        const x = 150 + i*150;
        const y = 150;
        ctx.fillStyle = (score>=s.unlock || unlockedSkins.includes(i)) ? s.color : 'gray';
        ctx.fillRect(x,y,60,60);
        ctx.strokeStyle='black';
        ctx.strokeRect(x,y,60,60);
        ctx.fillStyle='black';
        ctx.font='16px Arial';
        ctx.fillText(s.name,x-5,y+80);
        if(currentSkin===i) ctx.strokeStyle='red', ctx.strokeRect(x-3,y-3,66,66);
    });

    // Back button
    ctx.fillStyle='red';
    ctx.fillRect(canvas.width/2-75,canvas.height-80,150,50);
    ctx.fillStyle='white';
    ctx.font='22px Arial';
    ctx.fillText('Back',canvas.width/2-25,canvas.height-45);
}

// Canvas click for menu & closet
canvas.addEventListener('click',e=>{
    const mx=e.offsetX, my=e.offsetY;
    if(!gameStarted){
        if(mx>canvas.width/2-75 && mx<canvas.width/2+75 && my>canvas.height/2 && my<canvas.height/2+50){
            gameStarted=true; restartGame();
        }
        if(mx>canvas.width/2-75 && mx<canvas.width/2+75 && my>canvas.height/2+70 && my<canvas.height/2+120){
            inCloset=true;
        }
    } else if(inCloset){
        // Skins
        skins.forEach((s,i)=>{
            const x = 150 + i*150;
            const y = 150;
            if(mx>x && mx<x+60 && my>y && my<y+60){
                if(score>=s.unlock || unlockedSkins.includes(i)) currentSkin=i;
            }
        });
        // Back
        if(mx>canvas.width/2-75 && mx<canvas.width/2+75 && my>canvas.height-80 && my<canvas.height-30){
            inCloset=false;
        }
    } else if(gameOver){
        if(mx>canvas.width/2-75 && mx<canvas.width/2+75 && my>canvas.height/2+40 && my<canvas.height/2+90)
            restartGame();
    }
});

// Game loop
function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(!gameStarted){
        drawTitleScreen();
        requestAnimationFrame(gameLoop);
        return;
    }

    if(inCloset){
        drawClosetScreen();
        requestAnimationFrame(gameLoop);
        return;
    }

    if(!gameOver){
        // Movement
        if(keys['ArrowLeft']) player.x -= player.speed;
        if(keys['ArrowRight']) player.x += player.speed;
        if(keys['ArrowUp'] && player.canJump && player.jumpsLeft>0){
            player.dy = -15;
            player.jumpsLeft--;
            player.canJump=false;
        }

        // Gravity
        player.dy += gravity;
        player.y += player.dy;

        // Collision
        for(let p of platforms){
            if(player.x+player.width>p.x && player.x<p.x+p.width &&
               player.y+player.height>p.y && player.y+player.height<p.y+p.height+player.dy &&
               player.dy>=0){
                   player.dy=0;
                   player.y = p.y-player.height;
                   player.jumpsLeft=2;
               }
        }

        // Auto-scroll
        player.y += autoScrollSpeed;
        platforms.forEach(p=>p.y+=autoScrollSpeed);
        scrollY += autoScrollSpeed;

        // Remove off-screen platforms
        platforms = platforms.filter(p=>p.y<canvas.height+50);

        // Generate new platforms
        if(Math.min(...platforms.map(p=>p.y))>0) createPlatforms(-canvas.height);

        if(player.y>canvas.height) {
            gameOver=true;
            if(score>highScore) highScore=score;
        }

        score = Math.max(score,scrollY);

        // Check for new skin unlocks
        skins.forEach((s,i)=>{
            if(score>=s.unlock && !unlockedSkins.includes(i)){
                unlockedSkins.push(i);
                unlockMessage = `New Skin Unlocked: ${s.name}!`;
                unlockTimer = 180; // show for 3 seconds
            }
        });
    }

    drawPlatforms();
    drawPlayer();
    drawScore();
    drawUnlockMessage();
    if(gameOver) drawGameOver();

    requestAnimationFrame(gameLoop);
}

// INIT
createPlatforms();
gameLoop();
</script>
</body>
</html>
